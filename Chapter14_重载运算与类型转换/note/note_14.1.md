# 14.1 基本概念

重载运算符是具有特殊函数名的函数：名字由关键字 operator 和要定义的运算符号共同组成。

重载运算符函数的参数数量与运算对象的数量相同。  
第一个参数对应左侧运算对象，第二个参数对应右侧运算对象。

除了重载函数调用运算符 `operator()` 之外，其他重载运算符不能含有默认实参。

当运算符函数是成员函数时，左侧运算对象绑定到隐式的 `this` 指针上，因此显式的参数数量会少一个。

*对于一个运算符函数，它要么是类的成员，要么至少含有一个类类型的参数。*  
因此不能重载内置类型的运算。

只能重载已有的运算符，不能定义新的运算符。

|可|以|被|重载|的|运算符|
|:-:|:-:|:-:|:-:|:-:|:-:|
|`+`|`-`|`*`|`/`|`%`|`^`|
|`&`|`\|`|`~`|`!`|`,`|`=`|
|`<`|`>`|`<=`|`>=`|`++`|`--`|
|`<<`|`>>`|`==`|`!=`|`&&`|`\|\|`|
|`+=`|`-=`|`/=`|`%=`|`^=`|`&=`|
|`\|=`|`*=`|`<<=`|`>>=`|`[]`|`()`|
|`->`|`->*`|`new`|`new[]`|`delete`|`delete[]`|

不能被重载的运算符：`::` 、`.*` 、`.` 、`? :`

`data1 + data2` 等价于 `operator+(data1, data2)`  
`data1 += data2` 等价于 `data1.operator+=(data2)`

不应该重载 `,` 、`&` 、`&&` 、`||` 运算符：

* `,` 、`&&` 、`||` 的求值顺序规则无法在重载版本中保留
* `&&` 、`||` 的短路求值属性无法在重载版本中保留
* `,` 、`&` 已经定义了用于类类型对象时的特殊含义

如果某些操作在逻辑上与运算符相关，则它们适合于定义成重载的运算符：

* IO操作：`operator<<` 、`operator>>`
* 检查相等性：`operator==` 、`operator!=`
* 比较操作：`operator<` 、`operator>` 、`operator<=` 、`operator>=`
* 返回类型：
  * 逻辑运算符和关系运算符：返回 bool
  * 算术运算符：返回一个类类型的值
  * 赋值运算符和复合赋值运算符：返回左侧运算对象的引用

*只有当操作的含义对于用户来说清晰明了时才使用运算符，否则会出现歧义。*

*如果类含有算术运算符或者位运算符，那么最好也提供对应的复合赋值运算符。*

决定运算符是成员函数还是非成员函数的准则：

* 赋值（`=`）、下标（`[]`）、调用（`()`）和成员访问箭头（`->`）必须是成员函数
* 复合赋值运算符一般来说应该是成员函数，但并不是必须
* 改变对象状态的运算符或者与给定类型密切相关的运算符应该是成员函数（递增、递减、解引用）
* 左右两侧运算对象可以交换的，具有对称性的运算符应该是普通的非成员函数（算数、相等性、关系运算符、位运算符等）

如果想使用含有类对象的混合类型表达式，运算符就必须是非成员函数：

```cpp
string s = "hello";
const char *t = "world";

// operator+ 是非成员函数
string u = s + t; // 混合类型表达式 s + t 合法
string u = t + s; // 混合类型表达式 t + s 合法

// operator+ 是 string 的成员函数
string u = s + t; // 正确：等价于 s.operator+(t)
string u = t + s; // 错误：t 是 const char * 类型，没有 operator+ 成员函数
```

## 练习

* [练习 14.1](../src/quiz_14.1.md)
* [练习 14.2](../src/quiz_14.2.md)
* [练习 14.3](../src/quiz_14.3.md)
* [练习 14.4](../src/quiz_14.4.md)
* [练习 14.5](../src/quiz_14.5.cpp)
