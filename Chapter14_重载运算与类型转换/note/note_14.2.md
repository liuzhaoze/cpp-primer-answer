# 14.2 输入和输出运算符

*输入输出运算符必须是非成员函数，并且一般被声明为友元。*

## 14.2.1 重载输出运算符 <<

`operator<<` 的形式：

* 第一个形参是一个非常量 ostream 对象的引用
* 第二个形参是一个常量的引用
* 函数返回 ostream 形参的引用

例：

```cpp
ostream &operator<<(ostream &os, const T &item)
{
    os << /* 输出 item 的数据成员 */ ;
    return os;
}
```

*输出运算符主要负责打印对象的内容而非控制格式，因此不应该打印换行符。*

## 14.2.2 重载输入运算符 >>

`operator>>` 的形式：

* 第一个形参是运算符将要读取的流 istream 的引用
* 第二个形参是将要写入的非常量对象的引用
* 函数返回 istream 形参的引用

输入运算符必须检查输入的合法性，而输出运算符不需要：

```cpp
istream &operator>>(istream &is, T &item)
{
    is >> /* 写入 item 的数据成员 */ ;

    if (is) // 检查输入是否成功
    {
        // 输入成功，进行一些处理
    }
    else
    {
        item = T(); // 输入失败，赋予 item 一个默认初始化的对象，保证其可用性
        // 输入运算符应该负责从错误中恢复
    }

    return is;
}
```

执行输入运算符时可能发生的错误：

* 输入了错误的数据类型
* 读取操作到达文件末尾
* 遇到输入流的其他错误

即使输入操作成功了，但如果输入结果不符合实际意义的要求，输入运算符也应该设置流的条件状态以标示错误：

* `failbit` ：通常情况下只设置该标志即可
* `eofbit` ：表示文件耗尽
* `badbit` ：表示流被破坏

## 练习

* [练习 14.6](../src/quiz_14.6.md)
* [练习 14.7](../src/quiz_14.7.md)
* [练习 14.8](../src/quiz_14.8.cpp)
* [练习 14.9](../src/quiz_14.9.md)
* [练习 14.10](../src/quiz_14.10.md)
* [练习 14.11](../src/quiz_14.11.md)
* [练习 14.12](../src/quiz_14.12.cpp)
