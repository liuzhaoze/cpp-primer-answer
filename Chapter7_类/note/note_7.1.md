# 7.1 定义抽象数据类型

> 本章术语：
>  
> * 数据抽象（data abstraction）
> * 封装（encapsulation）
> * 接口（interface）：类的接口包括用户所能执行的操作
> * 实现（implementation）：类的实现包括类的数据成员、负责接口实现的函数体以及定义类所需的各种私有函数
> * 抽象数据类型（abstract data type）
> * 成员函数（member function）
> * 常量成员函数（const member function）
> * 构造函数（constructor）
> * 默认构造函数（default constructor）：类通过默认构造函数来控制默认初始化过程
> * 合成的默认构造函数（synthesized default constructor）：由编译器创建的构造函数
> * 构造函数初始值列表（constructor initialize list）

## 7.1.1 设计 Sales_data 类

## 7.1.2 定义改进的 Sales_data 类

成员函数的声明必须在类的内部，他的定义则既可以在类的内部也可以在类的外部。

作为接口组成部分的非成员函数，他们的定义和声明都在类的外部。

定义在类内部的函数是隐式的内联（inline）函数。定义在类外部的成员函数默认情况下不是内联的。

成员函数通过一个名为 **this** 的额外的隐式参数来访问调用它的那个对象。当我们调用一个成员函数时，用请求该函数的对象地址初始化 this 。  
任何对类成员的直接访问都被看作 this 的隐式引用。

常量成员函数： `std::string isbn() const { return this->bookNo; }`  
默认情况下， this 的类型是指向类类型**非常量版本**的常量指针。  
在常量成员函数中， this 的类型是指向类类型**常量版本**的常量指针。

*常量对象，以及常量对象的引用或指针都只能调用常量成员函数。*

编译器分两步处理类：首先编译成员的声明，然后才轮到成员函数体。  
因此，成员函数体可以随意使用类中的其他成员而无须在意这些成员出现的次序。

类外部定义的成员的名字必须包含他所属的类名：

```c
double Sales_data::avg_price(void) const
{
    if (unites_sole)
        return revenue / unites_sold;
    else
        return 0;
}
```

*一般来说，当我们定义的函数类似于某个内置运算符时，应该令该函数的行为尽量模仿这个运算符。*

## 7.1.3 定义类相关的非成员函数

一般来说，如果非成员函数是类接口的组成部分，则这些函数的声明应该与类在同一个头文件内。

IO 类属于不能被拷贝的类型，因此只能通过引用来传递它们。

print 函数不负责换行。  
执行输出任务的函数应该尽量减少对格式的控制，这样可以确保由用户代码来决定是否换行。

## 7.1.4 构造函数

构造函数的任务是初始化类对象的数据成员，无论何时，只要类的对象被创建，就会执行构造函数。

构造函数的函数名和类名相同。  
一个类可以包含多个构造函数，与重载函数差不多。

构造函数**不能**被声明成常量成员函数（即形参列表后面带有 const ）  
因为在对象的构造过程中，构造函数需要向对象的成员变量写入数据。

默认构造函数无须任何实参。

合成的默认构造函数将按照如下规则初始化类的数据成员：

* 如果存在类内的初始值，用他来初始化成员。
* 否则，默认初始化该成员。

*只有当类没有声明任何构造函数时，编译器才会自动地生成默认构造函数。一旦定义了其他构造函数，那么除非我们再定义一个默认构造函数，否则类将没有默认构造函数。*

*如果类包含内置类型或者复合类型（数组和指针）的成员，则只有当这些成员全都被赋予了类内的初始值时，这个类才适合于使用合成的默认构造函数。否则他们的值都是未定义的。*

*编译器不能为某些类合成默认构造函数：如果类中包含一个其他类类型的成员，且这个成员的类型没有默认构造函数，那么编译器将无法初始化该成员。*

定义默认构造函数： `Sales_data() = default;`  
`= default` 既可以和声明一起出现在类的内部，也可以作为定义出现在类的外部。  
和其他函数一样， 如果 `= default` 在类的内部，则默认构造函数是内联的；如果他在类的外部，则该成员默认情况下不是内联的。

构造函数初始值列表：

```c
Sales_data(const std::string &s, unsigned n, double p):
        bookNo(s), units_sold(n), revenue(p * n) {}
```

构造函数初始值列表是成员名字的一个列表，每个名字后面紧跟括号括起来的（或者在花括号内的）成员初始值。不同成员的初始化通过逗号分隔开来。  
当某个数据成员被构造函数初始值列表忽略时，他将以与合成默认构造函数相同的方式隐式初始化。  
因为构造函数初始值列表的唯一目的就是为数据成员赋初值，一旦没有其他任务需要执行，函数体 `{}` 也就为空了。

在类的外部定义构造函数：

```c
Sales_data::Sales_data(std::istream &is)
{
    read(is, *this);
}
```

## 7.1.5 拷贝、赋值和析构

在第 13 章中介绍如何自定义这些操作。

## 练习

* [练习 7.1](../src/quiz_7.1.cpp)
* [练习 7.2](../src/quiz_7.2.hpp)
* [练习 7.3](../src/quiz_7.3.cpp)
* [练习 7.4](../src/quiz_7.4.hpp)
* [练习 7.5](../src/quiz_7.5.hpp)
* [练习 7.6](../src/quiz_7.6.cpp)
* [练习 7.7](../src/quiz_7.7.cpp)
* [练习 7.8](../src/quiz_7.8.md)
* [练习 7.9](../src/quiz_7.9.cpp)
* [练习 7.10](../src/quiz_7.10.md)
* [练习 7.11](../src/quiz_7.11_main.cpp)
* [练习 7.12](../src/quiz_7.12.cpp)
* [练习 7.13](../src/quiz_7.13.cpp)
* [练习 7.14](../src/quiz_7.14.md)
* [练习 7.15](../src/quiz_7.15.cpp)
